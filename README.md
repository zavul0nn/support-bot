# Support Bot

> FSM-????????? ???????? ? SQLite ? ??????????? ????? ?????????????. ?????? ?????? FSM ????????????? ?????????.
> SQLite-???? ????????? ??? ??????, ???? ??? ???; ??????? ?????? ????????? ?????????????.
> ???????? ?? Redis ??????????? ???? ??? ??? ??????, ????? `REDIS_MIGRATE_ON_START=true`, ????? `REDIS_HOST`, ? SQLite ??? ??????.
> ????? ???????? ???????? ????? ??????? Redis ?? docker-compose ? ?????? `REDIS_HOST`.
> ?????? ?????? ???????? ? SQLite (???? ? ???????? ???????). Redis ???????????? ?????? ??? ??????? ????????.

[![License](https://img.shields.io/github/license/mrtesla07/support-bot)](LICENSE)
[![Telegram Bot](https://img.shields.io/badge/Bot-grey?logo=telegram)](https://core.telegram.org/bots)
[![Python](https://img.shields.io/badge/Python-3.12-blue.svg)](https://www.python.org/)
[![Docker](https://img.shields.io/badge/Docker-ready-blue?logo=docker)](https://www.docker.com/)

Support Bot ? ????????-??? ??? ????????? ?????????????. ?? ????????? ????????? ? ?????? ??????????, ????????? ?? ? ????? ??????? ?????? ? ?????????????? ????????? ???????.

## ???????????

- ?????????????? ???????? ????????? ???????? ???? ??? ??????? ????????????
- ?????????????? ????????? ? ?????????? ????? ????????? ????? ? ??????? ?????????
- ??????????? ?????????? ? ????????? ??????????
- ????????? ??????? `/resolve`, `/resolvequiet`, `/silent`, `/ban`, `/information`, `/newsletter`, `/menu`
- inline-?????? ?????????? ? ????????? ???? (????????, ????????, ??????? ??????, ????, ??????? ??????)
- ??????? ?????? ??? ?????????? (????? + ?????, ??????? ???????)
- ???????? ????????? ? ???????????? ??? ???????? ?????? ????????? ????? `/del`
- ????????-??????: ?????? ????????/??????, ????????? ????, ?????????????? ??? ?????????????? ????????

## Remnawave (???? ????????????)

??? ??????? ?? **????** ??? ??????? `/information` ??? ??????????? ?????? ???????????? ? Remnawave ?? Telegram ID ? ??????????:

- ?????? ? ?????
- ???? ??????? ??????????? ? ????????? ????????
- ?????? ?? ????? ? ?? ??? ?????
- ???????? ???? ? ????????? ?????? (????? ???????????? ?? MSK)
- ??? ???????? ?? ???????
- ?????????? ????????? ? ?????? ?????????
- ???????? ID ????????????
- ????????? ?????? (???? ????????)

??? ?????? ?????????? ??????? `REMNAWAVE_API_BASE` ? `REMNAWAVE_API_TOKEN`.
???????????: `REMNAWAVE_CADDY_TOKEN`, `REMNAWAVE_SSL_IGNORE=true`.

## ??????? ?????? ??? ??????????

- ??????????? ??????? (DEV_ID) ? ????? ????
- ???????????? ?????, ????, ?????, ?????????, ????????? ? ??????? (media group)
- ???????? ? ?????? ?????? ? ???????????? ????????????, ? ????? ??????????? ? ????

## ???????? ????????? (/del)

??????? `/del` ?????? ???? ??????? ?? ????????? ????????? ? ????. ??? ?????? ????????? ????????? ? ???????????? ? ? ????. ????? ????????? ???????? ? SQLite.

## ??????? ????? (????????)

```bash
git clone https://github.com/mrtesla07/support-bot.git
cd support-bot
cp .env.example .env
nano .env          # ????????? ????? ???? ? ?????????
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
python -m app
```

### ?????? ????? Docker

```bash
docker compose up -d --build
```

## ?????????? ? ????????

```bash
docker compose down
git pull
docker compose up -d --build
```

- `--build` ???????????? ????????? ? ??????????? ?????? ??????????? ?? `requirements.txt`
- ???????? ? ????????????? ???????? ??????????? ????????????? ??? ??????

## ?????????? ?????????

| ??? | ???????? |
|------------------------|--------------------------------------------------|
| `BOT_TOKEN` | ?????, ???????? @BotFather |
| `BOT_DEV_ID` | Telegram ID ?????????????? (?????? ? ??????? ? /newsletter) |
| `BOT_GROUP_ID` | ID ??????????, ???? ???????????? ????????? |
| `BOT_EMOJI_ID` | ????????? ?????? ??? ????? ????????? |
| `BOT_ACTIVE_EMOJI_ID` | ?????? ??? ??????? ? ?????????? (????? ?????? ?????????) |
| `BOT_RESOLVED_EMOJI_ID` | ?????? ??? ???????? ??????? |
| `BOT_DEFAULT_LANGUAGE` | ??? ????? ?? ????????? (`en`, `ru`, ? ?.?.) |
| `BOT_LANGUAGE_PROMPT_ENABLED` | `true/false`, ?????????? ?? ???? ?????? ????? |
| `BOT_REMINDERS_ENABLED` | `true/false`, ???????? ??????????? ?????????? |
| `SECURITY_FILTER_ENABLED` | `true/false`, ?????? ?????????/?????? t.me/telegram |
| `SQLITE_PATH` | ???? ? ????? SQLite (?? ????????? `./data/support-bot.sqlite3`) |
| `REMNAWAVE_API_BASE` | ??????? URL Remnawave API (???????? `https://panel.example/api`) |
| `REMNAWAVE_API_TOKEN` | ????? Remnawave API |
| `REMNAWAVE_CADDY_TOKEN` | ???????????? X-Api-Key ??? Caddy auth |
| `REMNAWAVE_SSL_IGNORE` | `true/false`, ???????????? SSL ? Remnawave |
| `REDIS_HOST` | ????? Redis (????? ?????? ??? ????????) |
| `REDIS_PORT` | ???? Redis |
| `REDIS_DB` | ????? ???? Redis |
| `REDIS_PASSWORD` | ?????? Redis |
| `REDIS_MIGRATE_ON_START` | `true/false`, ?????? ???????? Redis ? SQLite ??? ?????? |

## ?????????? ?? SQLite

- ??????? `./data` ????????? ?????????????
- ???? ???? ????????? ??? ??????, ???? ??? ???
- ??? ??????? ? Docker ????? ?? ???? ? ??????? ???????????? ?????????????; ???? chmod ?? ??????????, ??? ????? ?????????????? ? ???

## ?????

```bash
pytest
```

## ???????????? ??? ?????????????

- [??????????? ?? ??????????](docs/DEVELOPMENT.md)
- [???????? ?????](docs/ROADMAP.md)

## ?????????????

??? ????????????? ?? ?????? ??????? ???? ?????? `scripts/s-b.sh`. ??:

- ?????? Docker (Ubuntu ??? ????? ??????????? `get.docker.com`)
- ?????????/????????? `support-bot` ? ????????? ??????? (?? ????????? `/opt/support-bot`)
- ???????? `.env.example` ? ????????? `docker compose up -d --build`
- ???????????? ???? ? ?????????? `up/down/logs/pull` ? self-update

### ??? ????????????

```bash
curl -fsSL https://raw.githubusercontent.com/mrtesla07/support-bot/main/scripts/s-b.sh   | bash
```

## ????????? ?????

????? ???? ?????? ?????????? ????????? ????????, ?????????? **??????????????? ?????????** ?????????? ??? ??????? ????.

1. ???????? ??????? ??? ??????

```bash
/opt/support-bot-project-a
/opt/support-bot-project-b
```

2. ???????? ??????????? `.env`

```bash
cp .env.example .env
```

3. ?????????? ? ????????? `docker-compose.yml`

- ???????????? ??????? ? ??????????, ????? ????? ?? ?????????????
- ?????????? ????????? ??? ??? Redis, ???? ??????????? ????????:

```yaml
volumes:
  - ./redis/data-project-a:/data
```

4. ?????????? ? ?????????? ?????? ?????? ????????

```bash
docker compose up -d --build
```

## ????????? ????? Redis

???? ??? ????? ??????? ????? ?????? Redis-??????, ??????????? `scripts/redis_backup.py`.

```bash
python scripts/redis_backup.py backup --compress --keep 14
python scripts/redis_backup.py restore backups/support-bot-2025-10-20.rdb.gz --data-dir ./redis/data --yes --force
```

## ????????

?????? ???????????????? ?? ???????? [MIT](LICENSE).
